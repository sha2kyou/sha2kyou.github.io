const m="_top";class H extends HTMLElement{constructor(){super(),this._current=this.querySelector('a[aria-current="true"]'),this.minH=parseInt(this.dataset.minH||"2",10),this.maxH=parseInt(this.dataset.maxH||"3",10),this.tocHeadingSelector=`h1#${m},:where(${[...Array.from({length:1+this.maxH-this.minH}).map(((t,e)=>`h${this.minH+e}`))].join()})[id]`,this.onIdle=t=>(window.requestIdleCallback||(t=>setTimeout(t,1)))(t),this.init=()=>{const t=[...this.querySelectorAll("a")],e=t=>t.matches(this.tocHeadingSelector),n=t=>{if(!t)return null;const i=t;for(;t;){if(t.matches(".sl-markdown-content, main > *"))return document.getElementById(m);if(e(t))return t;const i=t.querySelector(this.tocHeadingSelector);if(i)return i;for(t=t.previousElementSibling;t?.lastElementChild;)t=t.lastElementChild;const r=n(t);if(r)return r}return n(i.parentElement)},i=e=>{for(const{isIntersecting:i,target:r}of e){if(!i)continue;const e=n(r);if(!e)continue;const o=t.find((t=>t.hash==="#"+encodeURIComponent(e.id)));if(o){this.current=o;break}}},r=document.querySelectorAll([`main :where(${this.tocHeadingSelector})`,`main :where(${this.tocHeadingSelector}, .sl-heading-wrapper) ~ *:not(:has(${this.tocHeadingSelector}))`,`main .sl-markdown-content > *:not(:has(${this.tocHeadingSelector}))`,`main > *:not(:has(${this.tocHeadingSelector}))`].join());let o;const s=()=>{o||(o=new IntersectionObserver(i,{rootMargin:this.getRootMargin()}),r.forEach((t=>o.observe(t))))};let c;s(),window.addEventListener("resize",(()=>{o&&(o.disconnect(),o=void 0),clearTimeout(c),c=setTimeout((()=>this.onIdle(s)),200)}))},this.onIdle((()=>this.init()))}set current(t){t!==this._current&&(this._current&&this._current.removeAttribute("aria-current"),t.setAttribute("aria-current","true"),this._current=t)}getRootMargin(){const t=(document.querySelector("header")?.getBoundingClientRect().height||0)+(this.querySelector("summary")?.getBoundingClientRect().height||0)+32;return`-${t}px 0% ${t+53-document.documentElement.clientHeight}px`}}customElements.define("starlight-toc",H);export{H as S};